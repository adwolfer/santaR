<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>santaR Theoretical Background • santaR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="santaR Theoretical Background">
<meta property="og:description" content="santaR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">santaR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting-started.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting started</a>
    </li>
    <li>
      <a href="../articles/prepare-input-data.html">How to prepare input for santaR</a>
    </li>
    <li>
      <a href="../articles/santaR-GUI.html">Graphical User Interface</a>
    </li>
    <li>
      <a href="../articles/theoretical-background.html">santaR theoretical background</a>
    </li>
    <li>
      <a href="../articles/selecting-optimal-df.html">Selecting an optimal number of degrees of freedom</a>
    </li>
    <li>
      <a href="../articles/automated-command-line.html">Automated command line analysis</a>
    </li>
    <li>
      <a href="../articles/plotting-options.html">Plotting options</a>
    </li>
    <li>
      <a href="../articles/advanced-command-line-functions.html">Advanced command line functions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adwolfer/santaR" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>santaR Theoretical Background</h1>
                        <h4 data-toc-skip class="author">Arnaud Wolfer</h4>
            
            <h4 data-toc-skip class="date">2019-10-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adwolfer/santaR/blob/HEAD/vignettes/theoretical-background.Rmd" class="external-link"><code>vignettes/theoretical-background.Rmd</code></a></small>
      <div class="hidden name"><code>theoretical-background.Rmd</code></div>

    </div>

    
    
<p><code>santaR</code> is a Functional Data Analysis (<em>FDA</em>) approach where each individual’s observations are condensed to a continuous smooth function of time, which is then employed as a new analytical unit in subsequent data analysis.</p>
<p><code>santaR</code> is designed to be automatically applicable to a <em>high number of variables</em>, while simultaneously accounting for:</p>
<ul>
<li><em>biological variability</em></li>
<li><em>measurement error</em></li>
<li><em>missing observations</em></li>
<li><em>asynchronous sampling</em></li>
<li><em>nonlinearity</em></li>
<li>
<em>low number of time points</em> (e.g. 4-10)</li>
</ul>
<p>This vignette focusses on the theoretical background underlying <code>santaR</code> and will detail:</p>
<ul>
<li>Concept of Functional Data Analysis</li>
<li>Main hypothesis</li>
<li>Signal extraction using splines</li>
<li>Group mean curve fitting</li>
<li>Intra-class variability (confidence bands on the Group mean curves)</li>
<li>Detection of significantly altered time-trajectories</li>
</ul>
<div class="section level2">
<h2 id="concept-of-functional-data-analysis">Concept of Functional Data Analysis<a class="anchor" aria-label="anchor" href="#concept-of-functional-data-analysis"></a>
</h2>
<p>Traditional times-series methodologies consider each measurement (or observation) - for example a metabolic response value at a defined time-point - as the basic representative unit. In this context, a time trajectory is composed of a set of discrete observations taken at subsequent times. Functional data analysis<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> is a framework proposed by Ramsay and Silverman which models continuously each measured values as variable evolves (e.g. time). Contrary to traditional time-series approaches, FDA consider a subject’s entire time-trajectory as a single data point. This continuous representation of the variable through time is then employed for further data analysis.</p>
<p>More precisely, FDA assumes that a variable’s time trajectory is the result of a smooth underlying function of time which must be estimated. Therefore, the analysis’ first step is to convert a subject’s successive observations to the underlying function <span class="math inline">\(F(t)\)</span> that can be evaluated at any desired time values</p>
<p>Two main challenges prescribe the exact characterisation of the true underlying function of time <span class="math inline">\(F(t)\)</span>. First, the limited number of discrete observations constrains to a finite time interval and does not cover all possible values, while the true underlying smooth process is infinitely defined. Secondly, intrinsic limitations and variabilities of the analytical platforms mean that the discrete observations are not capturing the true underlying function values, but a succession of noisy realisations.</p>
<p>A metabolite’s concentration over the duration of the experiment is the real quantity of interest. As the true smooth process <span class="math inline">\(F(t)\)</span> cannot be evaluated, due to the collection and analytical process only providing noisy snapshots of its value, an approximation of the underlying metabolite concentration <span class="math inline">\(f(t)\)</span> must be employed. This approximation can be computed by smoothing the multiple single measurements available.</p>
<p>The approximation of the underlying function of time, of a single variable observed on a single subject, is generated by smoothing <span class="math inline">\(y_i\)</span> observations taken at the time <span class="math inline">\(t_i\)</span>, such as:</p>
<p><span class="math display">\[y_{i}=f(t_{i})+\epsilon_{i}\]</span></p>
<p>Where <span class="math inline">\(f(t)\)</span> is the smoothed function that can be evaluated at any desired time <span class="math inline">\(t\)</span> within the defined time domain, and <span class="math inline">\(\epsilon_i\)</span> is an error term allowing for measurement errors. By extension, if <span class="math inline">\(f(t)\)</span> is defined as representing the true variable level across a population, <span class="math inline">\(\epsilon\)</span> can allow for both individual specific deviation and measurement error.</p>
<p>In order to parametrise and computationally manipulate the smooth approximation, the representation is projected onto a finite basis, which expresses the infinitesimally dimensional <span class="math inline">\(f(t)\)</span> as a linear combination of a set of basis functions. A wide range of basis functions (e.g. polynomials, splines, wavelets, Fourier basis) are available, even if the most commonly used are Fourier basis for periodic data and splines for aperiodic trajectories<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<p>Following smoothing, a time-trajectory is expressed as a linear combination of a set of basis functions, for which values can be computer at any desired time without reconsidering the discrete observations. It is assumed that, if a satisfactory fit of the original data is obtained, both the new smooth approximation and the preceding noisy realisations should provide a similar representation of the underlying process<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> <a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<p>In practice, by assuming and parametrising <em>(explicitely or implicitely)</em> the smoothness of the function and leveraging multiple measurements in time as well as multiple individual trajectories, the smoothed representation can implicitly handle noisy metabolic responses. Additionally, as functional representations do not rely on the input data after their generation, smoothing approaches can handle irregular sampling and missing observations, translating to trajectories that can be compared without requiring missing values imputation. As such, the FDA framework and the smoothness assumption provide the necessary tools for the time-dependent analysis of short and noisy metabolic time-trajectories.</p>
</div>
<div class="section level2">
<h2 id="main-hypothesis">Main hypothesis<a class="anchor" aria-label="anchor" href="#main-hypothesis"></a>
</h2>
<p>The working hypothesis is that analyte values are representative of the underlying biological mechanism responsible for the observed phenotype and evolve smoothly through time. The resulting measurements are noisy realisations of these underlying smooth functions of time.</p>
<p>Based on previous work performed in Functional Data Analysis, short time evolutions can be analysed by estimating each individual trajectory as a smooth spline or curve. These smooth curves collapse the point by point information into a new observational unit that enables the calculation of a group mean curve or individual curves, each representative of the true underlying function of time.</p>
<p>Further data analysis then results in the estimation of the intra-class variability and the identification of time trajectories significantly altered between classes.</p>
</div>
<div class="section level2">
<h2 id="signal-extraction-using-splines">Signal extraction using splines<a class="anchor" aria-label="anchor" href="#signal-extraction-using-splines"></a>
</h2>
<p>Fitting splines to time trajectories is equivalent to a denoising or signal extraction problem: balancing the fitting of raw data versus the smoothing of the biological variability and measurement errors. Splines are piecewise polynomials with boundary continuity and smoothness constraints, which require a minimum of assumptions about the underlying form of the data<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> <a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> <a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>. The complexity of the fit is controlled by a single smoothing parameter <span class="math inline">\(\lambda\)</span>.</p>
<p>The data <span class="math inline">\(y_{ij}\)</span> of individual <span class="math inline">\(i\)</span>, <span class="math inline">\(i=1,.,n_k\)</span>, observed at time points <span class="math inline">\(t_{ij}\)</span>, <span class="math inline">\(j=1,.,m_i\)</span>, in a group of <span class="math inline">\(n_k\)</span> individuals, is modelled by a smoothing spline <span class="math inline">\(f_i(t_{ij})\)</span> of continuous first and second derivatives that minimizes the penalized residual sum of squares (<em>PRSS</em>) (Eq. 1):</p>
<p><span class="math display">\[PRSS(f_{i},\lambda)=\sum_{j=1}^{m_{i}} \{y_{ij} - f_i(t_{ij})\}^2 + \lambda \int_{t_{min}}^{t_{max}}\{\ddot{f_i(t)}\}^2~dt\]</span> (Eq. 1)</p>
<p>The first term of Eq. 1 is the squared error of employing the curve <span class="math inline">\(f_i(t)\)</span> to predict <span class="math inline">\(y_{ij}\)</span>, measuring the closeness of the function to the data. The second term penalises the curvature of the function while <span class="math inline">\(\lambda\)</span> controls the trade-off between both terms. The smoothing parameter <span class="math inline">\(\lambda\)</span> is shared among all individuals. The monotonic relationship between the smoothing parameter <span class="math inline">\(\lambda\)</span> and the desired equivalent number of degrees of freedom (<em>df</em>) of the corresponding fit (Eq. 2), allows us to control the closeness of curve fitting by varying <em>df</em><a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>.</p>
<p><span class="math display">\[df_{\lambda}=trace(S_{\lambda})\]</span> (Eq. 2)</p>
<p>where <span class="math inline">\(S_{\lambda}\)</span> is the smoother matrix (roughness matrix, or hat matrix) which transforms the observed data vector to the vector of fitted values (for more information see Eubank<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>, and Buja <em>et al</em>.<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>).</p>
<p>The <em>df</em> parameter controls how closely the spline fits the input data. For example, when <em>df</em> is minimal (<em>df</em>=2), the smoothing is maximised and the original data points fitted with a straight line. On the other hand, when <em>df</em> approaches the number of time-points, every data point is fitted without smoothing, which can result in an over-fit of the raw measurements.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>

<span class="co"># Sample a gaussian distribution, add noise to it</span>
<span class="va">x</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1.5</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span>,  <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>
<span class="va">y</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span>, log<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">y_noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">90</span><span class="op">)</span>

<span class="co"># Fit different smoothing splines, project on a grid for plotting</span>
<span class="va">time</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">0.01</span> <span class="op">)</span>
<span class="va">tmp_fit0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, df<span class="op">=</span><span class="fl">13</span><span class="op">)</span>
<span class="va">tmp_fit1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_noise</span>, df<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">tmp_fit2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_noise</span>, df<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
<span class="va">tmp_fit3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_noise</span>, df<span class="op">=</span><span class="fl">13</span><span class="op">)</span>

<span class="va">pred0</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> object<span class="op">=</span><span class="va">tmp_fit0</span>, x<span class="op">=</span><span class="va">time</span> <span class="op">)</span>
<span class="va">pred1</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> object<span class="op">=</span><span class="va">tmp_fit1</span>, x<span class="op">=</span><span class="va">time</span> <span class="op">)</span>
<span class="va">pred2</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> object<span class="op">=</span><span class="va">tmp_fit2</span>, x<span class="op">=</span><span class="va">time</span> <span class="op">)</span>
<span class="va">pred3</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> object<span class="op">=</span><span class="va">tmp_fit3</span>, x<span class="op">=</span><span class="va">time</span> <span class="op">)</span>

<span class="va">tmpPred0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> x<span class="op">=</span><span class="va">pred0</span><span class="op">$</span><span class="va">x</span>, y<span class="op">=</span><span class="va">pred0</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
<span class="va">tmpPred1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> x<span class="op">=</span><span class="va">pred1</span><span class="op">$</span><span class="va">x</span>, y<span class="op">=</span><span class="va">pred1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
<span class="va">tmpPred2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> x<span class="op">=</span><span class="va">pred2</span><span class="op">$</span><span class="va">x</span>, y<span class="op">=</span><span class="va">pred2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
<span class="va">tmpPred3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> x<span class="op">=</span><span class="va">pred3</span><span class="op">$</span><span class="va">x</span>, y<span class="op">=</span><span class="va">pred3</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>

<span class="va">tmpRaw</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> x<span class="op">=</span><span class="va">x</span>,  y<span class="op">=</span><span class="va">y</span><span class="op">)</span>
<span class="va">tmpNoisy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> x<span class="op">=</span><span class="va">x</span>,  y<span class="op">=</span><span class="va">y_noise</span><span class="op">)</span>

<span class="co"># Plot original data and spline representations</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, environment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="va">p0</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">tmpRaw</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1.5</span> <span class="op">)</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="va">p0</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">tmpPred0</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">'springgreen3'</span> <span class="op">)</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="va">p0</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">atop</a></span><span class="op">(</span><span class="st">'True underlying'</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'function of time'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, environment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="op">-</span><span class="fl">0.25</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">tmpNoisy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1.5</span> <span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">tmpPred1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">'blue'</span> <span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">atop</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">*</span><span class="st">' -&gt; '</span><span class="op">*</span><span class="va">infinity</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'DF = 2'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, environment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="op">-</span><span class="fl">0.25</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">tmpNoisy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1.5</span> <span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">tmpPred2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">'blue'</span> <span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">atop</a></span><span class="op">(</span><span class="st">'Optimal '</span><span class="op">*</span><span class="va">lambda</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Optimal DF'</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, environment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="op">-</span><span class="fl">0.25</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">tmpNoisy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1.5</span> <span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">tmpPred3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">'blue'</span> <span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">atop</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">*</span><span class="st">' = 0'</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'DF = N'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p0</span>,<span class="va">p1</span>,<span class="va">p2</span>,<span class="va">p3</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<p><img src="theoretical-background_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<blockquote>
<p>Multiple smoothing-spline fits of noisy realisations generated from a true smooth underlying function of time . A true smooth underlying function (continuous green line) is observed at multiple time points (dots). Noise is added to these measurements and the underlying function is approximated using smooth-splines at multiple levels of smoothness (blue continuous line).</p>
<ul>
<li><p>Excessive smoothness makes the fit less sensitive to the data, resulting in an under-fitted model.</p></li>
<li><p>When the curvature is not penalised an interpolating spline passing exactly through each point is selected, resulting in an over-fitted model.</p></li>
<li><p>At intermediate levels of smoothness, a compromise between the goodness-of-fit and model complexity can be achieved, generating a satisfactory approximation of the true underlying function of time.</p></li>
</ul>
</blockquote>
<p>In practice, the results are resilient to the <em>df</em> value selected across all variables, which is a function of the <em>study design</em>, such as the <em>number of time-points</em>, <em>sampling rate</em> and, most importantly, the <em>complexity of the underlying function of time</em>. While an automated approach cannot infer the study design from a limited set of observations, an informed user will intuitively achieve a more consistent fit of the data.</p>
<p><code>santaR</code> considers <em>df</em> as the single meta-parameter a user must choose prior to analysis, balancing the fitting of raw observations versus the smoothing of the biological variability and measurements errors. In turn, this explicit selection of the model complexity reduces the execution time and increases the reproducibility of results for a given experiment and across datasets.</p>
<p>For more information regarding the selection of an optimal value of <em>df</em> see the vignette <a href="selecting-optimal-df.html">‘Selecting an optimal number of degrees of freedom’</a></p>
</div>
<div class="section level2">
<h2 id="group-mean-curve-fitting">Group mean curve fitting<a class="anchor" aria-label="anchor" href="#group-mean-curve-fitting"></a>
</h2>
<p>Individual time-trajectories provide with subject-specific approximations of the underlying function of time. If a homogenous subset of the population (or group) can be devised, the replication of the experiment over this group can be leveraged to generate a group mean curve. This group mean curve provide with an approximation of the underlying function of time potentially dissociated of inter-individual variability.</p>
<p>A group mean curve <span class="math inline">\(g(t)\)</span>, representing the underlying function of time for a subset of the population, is defined as the mean response across all <span class="math inline">\(i\)</span> group subjects (where <span class="math inline">\(i=1,.,n_k\)</span>) (Equation 3): <span class="math display">\[g(t)=\frac{1}{n_k} \sum_{i=1}^{n_k} f_i(t) = \overline{f_i(t)}\]</span> (Eq. 3)</p>
<p>Following the framework of FDA, each individual trajectory is employed as the new basic unit of information. The group mean curve therefore employs the back-projection of each individual curve at every time of interest, instead of relying on each discrete measurement. This way the group mean curve fit is resilient to missing samples in a subject trajectory or asynchronous measurement across individuals.</p>
<p><img src="theoretical-background_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<blockquote>
<p>Multiple group mean curve fits (Center and Right) based on measurements generated from a true smooth underlying function of time (Left) with added inter-individual variability and missing observations. Multiple individual trajectories (Left, dashed green lines) are generated from a true underlying function of time (Left, continuous green line). Discrete measurements are generated (dots). Group mean curves are computed on a subset of these measurements (Center and Right, continuous blue line, 5 effective degrees of freedom). When the group mean curve is generated solely based on measurements (Center), the true underlying function of time is not satisfactorily approximated (fundamental unit of information is the observation). When the group mean curve (Right, continuous blue line) is generated from each individual curves (Right, dashed blue lines) a satisfactory approximation of the true underlying function of time can be obtained (fundamental unit of information is the functional representation of each individual).</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="intra-class-variability-confidence-bands-on-the-group-mean-curves">Intra-class variability (confidence bands on the group mean curves)<a class="anchor" aria-label="anchor" href="#intra-class-variability-confidence-bands-on-the-group-mean-curves"></a>
</h2>
<p>Confidence bands are employed to represent the uncertainty in an function’s estimate based on limited or noisy data. Pointwise confidence bands on the group mean curve can therefore provide a visualisation of the variance of the overall mean function through time. The confidence bands indicate for each possible time, values of the mean curve which could have been produced by the provided individual trajectories, with at least a given probability.</p>
<p>As the underlying distribution of <span class="math inline">\(F(t)\)</span> is unknown and inaccessible, confidence on <span class="math inline">\(g(t)\)</span> must be estimated by sampling the approximate distribution available (i.e. the measurements), achieved by bootstrapping the observations<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a> <a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> <a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>. Bootstrap assumes that sampling the distribution under a good estimate of the truth (the measurements) should be close to sampling the distribution under the true process. Once a bootstrapped distribution of mean curve is estimated, using the percentile method a pointwise confidence interval on <span class="math inline">\(g(t)\)</span> can be calculated<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a> <a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a> <a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a> by taking the <span class="math inline">\(\alpha/2\)</span> and <span class="math inline">\(1-\alpha/2\)</span> quantiles at each time-point of interest (where <span class="math inline">\(\alpha\)</span> is the error quantile in percent).</p>
<p>As limited assumptions on the fitted model can be established, empirical confidence bands on the group mean curve are calculated based on a non-parametric bootstrapped distribution. Individual curves are sampled with replacement and group mean curves calculated. The distribution of group mean curve is then employed to estimate the pointwise confidence bands.</p>
</div>
<div class="section level2">
<h2 id="detection-of-significantly-altered-time-trajectories">Detection of significantly altered time-trajectories<a class="anchor" aria-label="anchor" href="#detection-of-significantly-altered-time-trajectories"></a>
</h2>
<p>With a continuous time representation of a metabolite’s concentration accessible (i.e. the group mean curve), a metric quantifying a global difference between such curves can be devised. This measure of difference, independent of the original sampling of the data (e.g. asynchronous and missing measurements), can then be employed to determine whether the group mean curves are identical across the two groups and calculate the significance of the result.</p>
<p>In order to identify time-trajectories that are significantly altered between two experimental groups <span class="math inline">\(G_1\)</span> and <span class="math inline">\(G_2\)</span>, this global measure must be established. The measure must be able to detect baseline difference when both curves present the same shape, but also shape differences when the mean values across time are identical for both groups. We postulate that the area between two group mean curves fitted independently <span class="math inline">\(g_1(t)\)</span> and <span class="math inline">\(g_2(t)\)</span> (Eq. 3) is a good measure of the degree to which the two group time-trajectories differ. This global distance measure is calculated as:</p>
<p><span class="math display">\[dist(g_1,g_2) = \int_{t_{min}}^{t_{max}} |g_1(t)-g_2(t)| ~dt\]</span> (Eq. 4)</p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(t_{min}\)</span> and <span class="math inline">\(t_{max}\)</span> are the lower and upper bound of the time course.</li>
</ul>
<p>The global distance measure is a quantification of evidence for differential time evolution, and the larger the value, the more the trajectories differ.</p>
<p>Given the groups <span class="math inline">\(G_1\)</span>, <span class="math inline">\(G_2\)</span>, their respective group mean curves <span class="math inline">\(g_1(t)\)</span>, <span class="math inline">\(g_2(t)\)</span> and the observed global distance measure <span class="math inline">\(dist(g_1,g_2)\)</span>, the question of the significance of the difference between the two time trajectories is formulated as the following hypothesis-testing problem:</p>
<ul>
<li>
<span class="math inline">\(H_0\)</span>: <span class="math inline">\(g_1(t)\)</span> and <span class="math inline">\(g_2(t)\)</span> are identical.</li>
<li>
<span class="math inline">\(H_1\)</span>: The two curves are not the same.</li>
</ul>
<p>Under the null hypothesis <span class="math inline">\(H_0\)</span>, the global distance between <span class="math inline">\(g_1(t)\)</span> and <span class="math inline">\(g_2(t)\)</span> can be generated by a randomly permuting the individuals between two groups. Under the alternate hypothesis <span class="math inline">\(H_1\)</span>, the two curves are different, and very few random assignment of individuals to groups will generate group mean curves that differ more than the observed ones (i.e. a larger global distance).</p>
<p>In order to test the null hypothesis, the observed global distance must be compared to the expected global distance under the null hypothesis. The null distribution of the global distance measure is inferred by repeated permutations of the individual class labels<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>. Individual trajectories are fit using the chosen <em>df</em> and randomly assigned in one of two groups of size <span class="math inline">\(s_1\)</span> and <span class="math inline">\(s_2\)</span> (identical to the size of <span class="math inline">\(G_1\)</span> and <span class="math inline">\(G_2\)</span> respectively). The corresponding group mean curves <span class="math inline">\(g'_1(t)\)</span> and <span class="math inline">\(g'_2(t)\)</span> computed, and a global distance <span class="math inline">\(dist(g'_1,g'_2)\)</span> calculated. This is repeated many times to form the null distribution of the global distance. From this distribution a <span class="math inline">\(p\)</span>-value can be computed as the proportion of global distance as extreme or more extreme than the observed global distance (<span class="math inline">\(dist(g_1,g_2)\)</span>). The <span class="math inline">\(p\)</span>-value indicates the probability (if the null hypothesis was true) of a global difference as, or more, extreme than the observed one. If the <span class="math inline">\(p\)</span>-value is inferior to an agreed significance level, the null hypothesis is rejected.</p>
<p>Due to the stochastic nature of the permutations, the null distribution sampled depends on the random draw, resulting in possible variation of the <span class="math inline">\(p\)</span>-value. Variation on the permuted <span class="math inline">\(p\)</span>-value can be described by confidence intervals. The <span class="math inline">\(p\)</span>-value is considered as the success probability parameter <span class="math inline">\(p\)</span> in <span class="math inline">\(n\)</span> independent Bernoulli trials, where <span class="math inline">\(n=B\)</span> the total number of permutation rounds<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>. Confidence intervals on this binomial distribution of parameter <span class="math inline">\(p\)</span> and <span class="math inline">\(n\)</span> can then be computed. As extreme <span class="math inline">\(p\)</span>-values are possible (i.e close to 0) and the number of permutation rounds could be small, the Wilson score interval<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a> is employed to determine the confidence intervals (Eq. 5):</p>
<p><span class="math display">\[p_\pm = \frac{1}{1+\frac{1}{B}z^2}\left ( p + \frac{1}{2B}z^2 \pm z\sqrt{\frac{1}{B} p (1 - p) + \frac{1}{4B^2}z^2 }  \right )\]</span> (Eq. 5)</p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(p_\pm\)</span> is the upper or lower confidence interval.</li>
<li>
<span class="math inline">\(p\)</span> is the calculated <span class="math inline">\(p\)</span>-value.</li>
<li>
<span class="math inline">\(B\)</span> the total number of permutation rounds.</li>
<li>
<span class="math inline">\(z\)</span> is the <span class="math inline">\(1-1/2\alpha\)</span> quantile of the standard normal distribution, with <span class="math inline">\(\alpha\)</span> the error quantile.</li>
</ul>
<p>Lastly, if a large number of variables are investigated for significantly altered trajectories, significance results must be corrected for multiple hypothesis testing. Here we employ the well-known Benjamini &amp; Hochberg false discovery rate approach<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a> as default, with other methods available as an option.</p>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li><a href="getting-started.html">Getting Started with santaR</a></li>
<li><a href="prepare-input-data.html">How to prepare input data for santaR</a></li>
<li><a href="santaR-GUI.pdf">Graphical user interface use</a></li>
<li><a href="automated-command-line.html">Automated command line analysis</a></li>
<li><a href="plotting-options.html">Plotting options</a></li>
<li><a href="selecting-optimal-df.html">Selecting an optimal number of degrees of freedom</a></li>
<li><a href="advanced-command-line-functions.html">Advanced command line options</a></li>
</ul>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Ramsay, J. &amp; Silverman, B. W. <em>Functional Data Analysis</em> Springer, 431 (John Wiley &amp; Sons, Ltd, Chichester, UK, 2005)<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Ramsay, J., Hooker, G. &amp; Graves, S. <em>Functional data analysis with R and MATLAB</em> (Springer-Verlag, 2009)<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Ramsay, J. O. &amp; Silverman, B. <em>Applied functional data analysis: methods and case studies</em> (eds Ramsay, J. O. &amp; Silverman, B. W.) (Springer New York, New York, NY, 2002)<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Ramsay, J. &amp; Silverman, B. W. <em>Functional Data Analysis</em> Springer, 431 (John Wiley &amp; Sons, Ltd, Chichester, UK, 2005)<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Ramsay, J. &amp; Silverman, B. W. <em>Functional Data Analysis</em> Springer, 431 (John Wiley &amp; Sons, Ltd, Chichester, UK, 2005)<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Ramsay, J., Hooker, G. &amp; Graves, S. <em>Functional data analysis with R and MATLAB</em> (Springer-Verlag, 2009)<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Anselone, P. M. &amp; Laurent, P. J. A general method for the construction of interpolating or smoothing spline-functions. <em>Numer. Math</em>. 12, 66-82 (1968)<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Green, P. &amp; Silverman, B. W. <em>Nonparametric regression and generalized linear models: a roughness penalty approach</em>. (Chapman &amp; Hall/CRC, 1994)<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>de Boor, C. <em>A Practical Guide to Splines</em>. (Springer-Verlag, 1978)<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Hastie, T., Tibshirani, R. &amp; Friedman, J. <em>The Elements of Statistical Learning</em>. (Springer, 2009)<a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>Eubank, R. . The hat matrix for smoothing splines. <em>Stat. Probab. Lett</em>. 2, 9-14 (1984)<a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>Buja, A., Hastie, T. &amp; Tibshirani, R. Linear Smoothers and Additive Models. <em>Ann. Stat</em>. 17, 453-510 (1989)<a href="#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>Efron, B. Bootstrap Methods: Another Look at the Jackknife. <em>Ann. Stat</em>. 7, 1-26 (1979)<a href="#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>Davison, A. &amp; Hinkley, D. <em>Bootstrap methods and their application</em>. (Cambridge University Press, 1997)<a href="#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>Davison, A. C., Hinkley, D. V. &amp; Young, G. A. Recent Developments in Bootstrap Methodology. <em>Stat. Sci</em>. 18, 141-157 (2003)<a href="#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>Claeskens, G. &amp; Van Keilegom, I. Bootstrap confidence bands for regression curves and their derivatives. <em>Ann. Stat</em>. 31, 1852-1884 (2003)<a href="#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p>DiCiccio, T. J. &amp; Efron, B. Bootstrap confidence intervals. <em>Stat. Sci</em>. 11, 189-228 (1996)<a href="#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p>Efron, B. Better bootstrap confidence intervals. <em>J. Am. Stat. Assoc</em>. 82, 171-185 (1987)<a href="#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>Ernst, M. D. Permutation Methods: A Basis for Exact Inference. <em>Stat. Sci</em>. 19, 676-685 (2004)<a href="#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>Li, J., Tai, B. C. &amp; Nott, D. J. Confidence interval for the bootstrap P-value and sample size calculation of the bootstrap test. <em>J. Nonparametr. Stat</em>. 21, 649-661 (2009)<a href="#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>Wilson, E. B. Probable Inference, the Law of Succession, and Statistical Inference. <em>J. Am. Stat. Assoc</em>. 22, 209 (1927)<a href="#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p>Benjamini, Y. &amp; Hochberg, Y. Controlling the False Discovery Rate: A Practical and Powerful Approach to Multiple Testing. <em>J. R. Stat. Soc. Ser. B</em> 57, 289 - 300 (1995)<a href="#fnref22" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Arnaud Wolfer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
